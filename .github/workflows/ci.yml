name: CI

on:
 pull_request:
 push:
  branches:
   - main
   - master

permissions:
 contents: read

jobs:
 validate:
  runs-on: ubuntu-latest

  steps:
   - name: Checkout
     uses: actions/checkout@v4

   - name: Setup Node.js 20
     uses: actions/setup-node@v4
     with:
      node-version: 20

   - name: Setup Bun 1.3.5
     uses: oven-sh/setup-bun@v2
     with:
      bun-version: 1.3.5

   - name: Cache Bun package cache
     uses: actions/cache@v4
     with:
      path: ~/.bun/install/cache
      key: ${{ runner.os }}-bun-${{ hashFiles('bun.lock') }}
      restore-keys: |
       ${{ runner.os }}-bun-

   - name: Install dependencies
     run: bun install --frozen-lockfile

   - name: Typecheck
     run: bun run typecheck

   - name: Unit tests
     run: bun run test

   - name: Build
     run: bun run build
